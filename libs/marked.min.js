// Minimal marked shim for extension use.
// This is a tiny markdown -> HTML converter providing `marked.parse()`.
// It is intentionally small; for full markdown support replace this file with the official `marked` bundle.
(function (global) {
  const marked = {
    parse: function (md) {
      if (md == null) return '';
      let html = String(md);

      // Headings
      html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
      html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
      html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');

      // Bold and italic
      html = html.replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>');
      html = html.replace(/\*(.*?)\*/gim, '<em>$1</em>');

      // Inline code
      html = html.replace(/`([^`]+)`/gim, '<code>$1</code>');

      // Links
      html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/gim, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');

      // Paragraphs / line breaks
      html = html.replace(/\n{2,}/gim, '</p><p>');
      // wrap with <p> if not already block elements
      if (!/^\s*<\/?(h1|h2|h3|ul|ol|li|p)/i.test(html)) {
        html = '<p>' + html + '</p>';
      }
      html = html.replace(/\n/gim, '<br>');

      return html;
    }
  };

  try {
    global.marked = marked;
  } catch (e) {
    // In some environments use window
    window.marked = marked;
  }
})(this);
